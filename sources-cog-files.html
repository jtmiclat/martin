<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cloud Optimized GeoTIFF File Sources - Martin Tile Server Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="quick-start.html"><strong aria-hidden="true">1.</strong> Quick Start</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="quick-start-linux.html"><strong aria-hidden="true">1.1.</strong> On Linux</a></li><li class="chapter-item expanded "><a href="quick-start-macos.html"><strong aria-hidden="true">1.2.</strong> On macOS</a></li><li class="chapter-item expanded "><a href="quick-start-windows.html"><strong aria-hidden="true">1.3.</strong> On Windows</a></li><li class="chapter-item expanded "><a href="quick-start-qgis.html"><strong aria-hidden="true">1.4.</strong> View with QGIS</a></li></ol></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="run.html"><strong aria-hidden="true">3.</strong> Running</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="run-with-cli.html"><strong aria-hidden="true">3.1.</strong> Command Line Interface</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="env-vars.html"><strong aria-hidden="true">3.1.1.</strong> Environment Variables</a></li></ol></li><li class="chapter-item expanded "><a href="run-with-docker.html"><strong aria-hidden="true">3.2.</strong> Running with Docker</a></li><li class="chapter-item expanded "><a href="run-with-docker-compose.html"><strong aria-hidden="true">3.3.</strong> Running with Docker Compose</a></li><li class="chapter-item expanded "><a href="run-with-nginx.html"><strong aria-hidden="true">3.4.</strong> Running with NGINX</a></li><li class="chapter-item expanded "><a href="run-with-apache.html"><strong aria-hidden="true">3.5.</strong> Running with Apache</a></li><li class="chapter-item expanded "><a href="run-with-lambda.html"><strong aria-hidden="true">3.6.</strong> Running in AWS Lambda</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">3.7.</strong> Troubleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="config-file.html"><strong aria-hidden="true">4.</strong> Configuration File</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pg-connections.html"><strong aria-hidden="true">4.1.</strong> PostgreSQL Connections</a></li><li class="chapter-item expanded "><a href="sources-pg-tables.html"><strong aria-hidden="true">4.2.</strong> PostgreSQL Table Sources</a></li><li class="chapter-item expanded "><a href="sources-pg-functions.html"><strong aria-hidden="true">4.3.</strong> PostgreSQL Function Sources</a></li><li class="chapter-item expanded "><a href="sources-files.html"><strong aria-hidden="true">4.4.</strong> MBTiles and PMTiles File Sources</a></li><li class="chapter-item expanded "><a href="sources-cog-files.html" class="active"><strong aria-hidden="true">4.5.</strong> Cloud Optimized GeoTIFF File Sources</a></li><li class="chapter-item expanded "><a href="sources-composite.html"><strong aria-hidden="true">4.6.</strong> Composite Sources</a></li><li class="chapter-item expanded "><a href="sources-sprites.html"><strong aria-hidden="true">4.7.</strong> Sprite Sources</a></li><li class="chapter-item expanded "><a href="sources-fonts.html"><strong aria-hidden="true">4.8.</strong> Font Sources</a></li></ol></li><li class="chapter-item expanded "><a href="using.html"><strong aria-hidden="true">5.</strong> Usage and Endpoint API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="using-with-maplibre.html"><strong aria-hidden="true">5.1.</strong> Using with MapLibre</a></li><li class="chapter-item expanded "><a href="using-with-leaflet.html"><strong aria-hidden="true">5.2.</strong> Using with Leaflet</a></li><li class="chapter-item expanded "><a href="using-with-deck-gl.html"><strong aria-hidden="true">5.3.</strong> Using with deck.gl</a></li><li class="chapter-item expanded "><a href="using-with-mapbox.html"><strong aria-hidden="true">5.4.</strong> Using with Mapbox</a></li><li class="chapter-item expanded "><a href="using-with-openlayers.html"><strong aria-hidden="true">5.5.</strong> Using with OpenLayers</a></li><li class="chapter-item expanded "><a href="recipes.html"><strong aria-hidden="true">5.6.</strong> Recipes</a></li></ol></li><li class="chapter-item expanded "><a href="tools.html"><strong aria-hidden="true">6.</strong> Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="martin-cp.html"><strong aria-hidden="true">6.1.</strong> martin-cp bulk tile generation</a></li><li class="chapter-item expanded "><a href="mbtiles-meta.html"><strong aria-hidden="true">6.2.</strong> MBTiles Metadata</a></li><li class="chapter-item expanded "><a href="mbtiles-schema.html"><strong aria-hidden="true">6.3.</strong> MBTiles Schemas</a></li><li class="chapter-item expanded "><a href="mbtiles-copy.html"><strong aria-hidden="true">6.4.</strong> Copying MBTiles</a></li><li class="chapter-item expanded "><a href="mbtiles-diff.html"><strong aria-hidden="true">6.5.</strong> Diffing/Patching MBTiles</a></li><li class="chapter-item expanded "><a href="mbtiles-validation.html"><strong aria-hidden="true">6.6.</strong> Validating MBTiles</a></li></ol></li><li class="chapter-item expanded "><a href="development.html"><strong aria-hidden="true">7.</strong> Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="martin-as-a-library.html"><strong aria-hidden="true">7.1.</strong> Martin as a library</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Martin Tile Server Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/maplibre/martin" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/maplibre/martin/edit/main/docs/src/sources-cog-files.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cloud-optimized-geotiff-file-sources"><a class="header" href="#cloud-optimized-geotiff-file-sources">Cloud Optimized GeoTIFF File Sources</a></h1>
<p>Martin can also serve raster sources like local <a href="https://cogeo.org/">COG(Cloud Optimized GeoTIFF)</a> files. For cog on remote like S3 and other improvements, you could track them on <a href="https://github.com/maplibre/martin/issues/875">issue 875</a>, we are working on and welcome any assistance.</p>
<h2 id="supported-colortype-and-bits-per-sample"><a class="header" href="#supported-colortype-and-bits-per-sample">Supported colortype and bits per sample</a></h2>
<div class="table-wrapper"><table><thead><tr><th>colory type</th><th>bits per sample</th><th>supported</th><th>status</th></tr></thead><tbody>
<tr><td>rgb/rgba</td><td>8</td><td>✅</td><td></td></tr>
<tr><td>rgb/rgba</td><td>16/32…</td><td>🛠️</td><td>working on</td></tr>
<tr><td>gray</td><td>8/16/32…</td><td>🛠️</td><td>working on</td></tr>
</tbody></table>
</div>
<h2 id="supported-compression"><a class="header" href="#supported-compression">Supported compression</a></h2>
<ul>
<li>None</li>
<li>LZW</li>
<li>Deflate</li>
<li>PackBits</li>
</ul>
<h2 id="run-martin-with-cli-to-serve-cog-files"><a class="header" href="#run-martin-with-cli-to-serve-cog-files">Run Martin with CLI to serve cog files</a></h2>
<pre><code class="language-bash"># Configured with a directory containing `*.tif` or `*.tiff` TIFF files.
martin /with/tiff/dir1 /with/tiff/dir2
# Configured with dedicated TIFF file
martin /path/to/target1.tif /path/to/target2.tiff
# Configured with a combination of directories and dedicated TIFF files.
martin /with/tiff/files /path/to/target1.tif /path/to/target2.tiff
</code></pre>
<h2 id="run-martin-with-configuration-file"><a class="header" href="#run-martin-with-configuration-file">Run Martin with configuration file</a></h2>
<pre><code class="language-yml">keep_alive: 75

# The socket address to bind [default: 0.0.0.0:3000]
listen_addresses: '0.0.0.0:3000'

# Number of web server workers
worker_processes: 8

# Amount of memory (in MB) to use for caching tiles [default: 512, 0 to disable]
cache_size_mb: 8

# Database configuration. This can also be a list of PG configs.

cog:
  paths:
    # scan this whole dir, matching all *.tif and *.tiff files
    - /dir-path
    # specific TIFF file will be published as a cog source
    - /path/to/target1.tif
    - /path/to/target2.tiff
  sources:
    # named source matching source name to a single file
     cog-src1: /path/to/cog1.tif
     cog-src2: /path/to/cog2.tif
</code></pre>
<h2 id="about-cog"><a class="header" href="#about-cog">About COG</a></h2>
<p><a href="https://cogeo.org/">COG</a> is just Cloud Optimized GeoTIFF file.</p>
<p>TIFF is an image file format. TIFF tags are something like key-value pairs inside to describe the metadata about a TIFF file, ike <code>ImageWidth</code>, <code>ImageLength</code>, etc.</p>
<p>GeoTIFF is a valid TIFF file with a set of TIFF tags to describe the ‘Cartographic’ information associated with it.</p>
<p>COG is a valid GeoTIFF file with some requirements for efficient reading. That is, all COG files are valid GeoTIFF files, but not all GeoTIFF files are valid COG files. For quick access to tiles in TIFF files, Martin relies on the requirements/recommendations(like the <a href="https://docs.ogc.org/is/21-026/21-026.html#_requirement_reduced_resolution_subfiles">requirement about Reduced-Resolution Subfiles</a> and <a href="https://docs.ogc.org/is/21-026/21-026.html#_tiles">the content dividing strategy</a>) so we use the term <code>COG</code> over <code>GeoTIFF</code> in our documentation and configuration files.</p>
<p>You may want to visit these specs:</p>
<ul>
<li><a href="https://www.itu.int/itudoc/itu-t/com16/tiff-fx/docs/tiff6.pdf">TIFF 6.0</a></li>
<li><a href="https://docs.ogc.org/is/19-008r4/19-008r4.html">GeoTIFF</a></li>
<li><a href="https://docs.ogc.org/is/21-026/21-026.html">Cloud Optimized GeoTIFF</a></li>
</ul>
<h3 id="cog-generation-with-gdal"><a class="header" href="#cog-generation-with-gdal">COG generation with GDAL</a></h3>
<p>You could generate cog with <code>gdal_translate</code> or <code>gdalwarp</code>. See more details in <a href="https://gdal.org/en/latest/drivers/raster/cog.html">gdal doc</a>.</p>
<pre><code class="language-bash"># gdal-bin installation
# sudo apt update
# sudo apt install gdal-bin

# gdalwarp
gdalwarp src1.tif src2.tif out.tif -of COG

# or gdal_translate
gdal_translate input.tif output_cog.tif -of COG
</code></pre>
<h3 id="the-mapping-from-zxy-to-tiff-chunk"><a class="header" href="#the-mapping-from-zxy-to-tiff-chunk">The mapping from ZXY to tiff chunk</a></h3>
<ul>
<li>A single TIFF file could contains many sub-file about same spatial area, each has different resolution</li>
<li>A sub file is organized with many tiles</li>
</ul>
<p>So basically there’s a mapping from zxy to tile of sub-file of TIFF.</p>
<div class="table-wrapper"><table><thead><tr><th>zxy</th><th>mapping to</th></tr></thead><tbody>
<tr><td>Zoom level</td><td>which sub-file in TIFF file</td></tr>
<tr><td>X and Y</td><td>which tile in subfile</td></tr>
</tbody></table>
</div>
<p>Clients could read only the header part of COG to figure out the mapping from zxy to the chunk number and the subfile number. Martin get tile to frontend by this mapping.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="sources-files.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="sources-composite.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="sources-files.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="sources-composite.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
